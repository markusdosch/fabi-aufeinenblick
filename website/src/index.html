<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Fabi Kurse auf einen Blick</title>
    <link rel="stylesheet" href="npm:simpledotcss/simple.min.css" />
    <link
      rel="stylesheet"
      href="npm:datatables.net-dt/css/dataTables.dataTables.min.css"
    />
  </head>
  <body>
    <h1>Fabi Kurse auf einen Blick</h1>
    <table id="table" class="display" style="width: 100%">
      <thead>
        <tr>
          <th>Titel</th>
          <th>Ort</th>
          <th>Startdatum</th>
          <th>Plätze verfügbar?</th>
          <th>Preis</th>
        </tr>
      </thead>
    </table>
  </body>
  <script type="module">
    import DataTable from "datatables.net-dt";

    new DataTable("#table", {
      paging: false,
      ajax: {
        url: "courses.json",
        dataSrc: "",
      },
      oLanguage: {
        sSearch: "Suchen:",
      },
      columns: [
        { data: "title" },
        { data: "location" },
        { data: "start" },
        { data: "spotsleft" },
        { data: "price" },
      ],
      initComplete: function () {
        this.api()
          .columns()
          .every(function () {
            const column = this;

            // Create select element
            const select = document.createElement("select");
            select.style.width = "100%";

            select.add(new Option("Filtern..."));
            column.header().appendChild(select);

            // Apply listener for user change in value
            select.addEventListener("change", function () {
              column.search(select.value, { exact: true }).draw();
            });

            // Add list of options
            column
              .data()
              .unique()
              .sort()
              .each(function (d, j) {
                select.add(new Option(d));
              });
          });
      },
    });
  </script>
</html>
