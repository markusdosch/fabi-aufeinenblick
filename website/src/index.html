<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Fabi Kurse auf einen Blick</title>
    <link
      rel="stylesheet"
      href="npm:datatables.net-dt/css/dataTables.dataTables.min.css"
    />
  </head>
  <body>
    <h2>Fabi - Zeit für Familie</h2>
    <h3>Kurse auf einen Blick</h3>
    <table id="table" class="display" style="width: 100%">
      <thead>
        <tr>
          <th>Titel</th>
          <th>Standort</th>
          <th>Wochentag</th>
          <th>Startdatum</th>
          <th>Plätze verfügbar?</th>
          <th>Preis</th>
        </tr>
      </thead>
    </table>
  </body>
  <script type="module">
    import DataTable from "datatables.net-dt";
    import $ from "jquery";

    new DataTable("#table", {
      paging: false,
      language: {
        infoFiltered: " - gefiltert aus _MAX_ Einträgen",
        infoEmpty: "Kein Ergebnis",
      },
      layout: {
        topStart: {
          info: {
            text: "_TOTAL_ Einträge",
          },
        },
      },
      ajax: {
        url: "courses.json",
        dataSrc: "",
      },
      oLanguage: {
        sSearch: "Suchen:",
      },
      columns: [
        {
          data: "title",
          fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
            $(nTd).html(
              "<a target='_blank' rel='noopener' href='" +
                oData.url +
                "'>" +
                oData.title +
                "</a>"
            );
          },
        },
        {
          data: "location",
          fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
            $(nTd).html(
              "<span title='" +
                oData.location_exact +
                "'>" +
                oData.location +
                "</span>"
            );
          },
        },
        { data: "start_weekday" },
        { data: "start" },
        {
          data: "spots_left",
          fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
            $(nTd).html(oData.spots_left ? "✅" : "❌");
          },
        },
        { data: "price" },
      ],
      initComplete: function () {
        this.api()
          .columns()
          .every(function () {
            const column = this;

            // Create select element
            const select = document.createElement("select");
            select.style.width = "100%";

            select.add(new Option("Filtern..."));
            column.header().appendChild(select);

            // Apply listener for user change in value
            select.addEventListener("change", function () {
              column.search(select.value, { exact: true }).draw();
            });

            // Add list of options
            column
              .data()
              .unique()
              .sort()
              .each(function (d, j) {
                select.add(new Option(d));
              });
          });
      },
    });
  </script>
</html>
